# 인터럽트&시스콜

### 2023.04 2주차

## 인터럽트 (Interrupt)

: 프로그램을 실행하는 도중에 예기치 않은 상황이 발생할 경우 현재 실행중인 작업을 일시 중단하고, 발생된 상황을 우선 처리한 후 실행중이던 작업으로 복귀하여 계속 처리하는 것

: 프로세서(CPU)가 프로그램을 실행하고 있을 때, 입출력 장치나 예외 상황의 핸들링이 필요한 경우 프로세서에서 실행 중인 프로그램을 멈추고 상황을 처리하도록 하는 명령

## 인터럽트 종류

### 외부인터럽트

(= 하드웨어 인터럽트)

1. 타이머 인터럽트

   : 프로세스가 할당된 시간이 만료 후 다른 프로세스를 실행할 때 발생 → Context Switching

   - CPU의 시간을 공평하게 분배 (독점 방지)
   - 무한 루프나 예외 상황 등으로 인한 시스템 정지 방지에 사용

2. I/O 인터럽트

   : 입출력 장치가 데이터 전송을 요청하거나 전송이 끝나 다음 동작을 실행할 때 발생

   : 입출력 데이터에 이상이 있는 경우

   - 입출력 작업 시작 후 CPU는 입출력 작업이 끝날 때까지 기다리지 않고 다른 작업을 수행하다가 입출력 작업이 끝나 발생할 I/O 인터럽트를 기다림

3. 전원 이상 인터럽트

   : 정전, 파워 이상 등

   - 전원 이상이 생기면 CPU는 실행 중인 작업을 중단하고 전원 이상 인터럽트 발생
     → OS는 시스템이 안정적으로 종료 or 복구 작업 수행
   - 전원 이상 발생 시 (컴퓨터 전원이 꺼지면) 최소한의 예비 전력을 남김

### 내부 인터럽트

(= 소프트웨어 인터럽트)

1. Exception 인터럽트 (Trap)

   : CPU가 명령어를 수행하다 처리할 수 없는 예외 상황을 만났을 떄 발생

   - Java에서 1을 0으로 나누는 경우, 오버플로우 등
   - 프로그램의 안정성과 신뢰성을 보장
     → 예외가 처리되지 않거나 부적절하면 프로그램의 비정상적 종료 및 시스템에 치명적일 수 있음

2. SVC (Supervisor Call) 인터럽트

   : OS에 서비스를 요청하기 위해 인터럽트를 걸고 커널 모드로 전환하는 인터럽트

   : 시스템 콜 호출을 위한 인터럽트

   - 커널 모드로 전환되기 때문에 보안 문제에 신경써야 함

### 인터럽트 수행 과정

![스크린샷 2023-04-15 오후 9.51.16.png](img/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-04-15_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_9.51.16.png)

![스크린샷 2023-04-15 오후 9.50.17.png](img/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-04-15_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_9.50.17.png)

![스크린샷 2023-04-15 오후 9.49.29.png](img/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-04-15_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_9.49.29.png)

1. 인터럽트 요청
2. CPU가 처리하던 명령어 완료 후 중단
3. 현재 실행 중인 프로세스 상태 PCB에 저장, 다음에 실행할 명령어 주소 PC에 저장
4. 인터럽트 원인 판별
   - 커널 모드 전환 후 인터럽트 벡터 테이블에서 ISR 찾기
5. 인터럽트 처리 루틴 (ISR) 수행
6. 상태 복구
   - PCB에서 정보 가져오기
7. 중단된 명령어 수행

인터럽트 발생 → CPU 상태 저장 → 커널 모드 전환 → 인터럽트 벡터 → ISR 수행 → 저장된 상태 복구 → 복구한 명령어 수행

- 인터럽트 벡터
  : 인터럽트 종류마다 번호를 정해서 번호에 따라 처리해야할 코드의 주소를 가리키고 있는 자료구조
- 인터럽트 처리 루틴 (ISR, Interrupt Service Routine)
  : 여러가지 인터럽트에 대해 각각 처리해야할 업무 정의

### 인터럽트 우선순위

- 여러 인터럽트 발생하거나 ISR 수행 중 인터럽트 발생 시 우선순위 판별 필요
- 우선순위는 운영체제 별로 다르게 설계
- 보통 중요도가 높은 작업의 우선순위를 높게 설정
- 일반적으로 하드웨어 인터럽트가 소프트웨어 인터럽트보다 우선순위가 높음
  - 전원 이상
  - 기계 착오
  - 외부 신호
  - 입출력
  - 명령어 잘못
  - 프로그램 검사
  - svc

## 시스템 콜 (System call)

### CPU 모드

: CPU는 사용자 어플리케이션이 시스템을 손상시키는 것을 막기 위해 커널 모드(CPU에 있는 Mode bit 0), 사용자 모드로 구분

- 커널 모드 vs. 사용자 모드
  - 자원의 완전한 접근의 여부

![스크린샷 2023-04-15 오후 11.51.27.png](img/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-04-15_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_11.51.27.png)

### 시스템 콜

: OS에서 제공하는 서비스들을 활용하기 위한 프로그래밍 인터페이스

: 사용자 모드에서 커널 모드로 전환 (사용자 모드에서 커널 모드의 기능을 사용 가능하게)

![스크린샷 2023-04-16 오전 12.06.23.png](img/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-04-16_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%258C%25E1%2585%25A5%25E1%2586%25AB_12.06.23.png)

### 시스템 콜의 유형

1. 프로세스 제어 (Process Control)
   - 끝내기(end), 중지(abort)
   - 적재(load), 실행(execute)
   - 프로세스 생성(create process)
   - 프로세스 속성 획득과 설정(get process attribute and set process attribute)
   - 시간 대기(wait time)
   - 사건 대기(wait event)
   - 사건을 알림(signal event)
   - 메모리 할당 및 해제 : malloc, free
2. 파일 조작 (File Manipulation)
   - 파일 생성(create file), 파일 삭제(delete file)
   - 열기(open), 닫기(close)
   - 읽기(read), 쓰기(write), 위치 변경(reposition)
   - 파일 속성 획득 및 설정(get file attribute and set file attribute)
3. 장치 관리 (Devide Management)
   - 장치를 요구(request devices), 장치를 방출release device)
   - 읽기, 쓰기, 위치 변경
   - 장치 속성 획득, 장치 속성 설정
   - 장치의 논리적 부착(attach) 또는 분리(detach)
4. 정보 유지 (Information Maintenance)
   - 시간과 날짜의 설정과 획득(time)
   - 시스템 데이터의 설정과 획득(date)
   - 프로세스 파일, 장치 속성의 획득 및 설정
5. 통신 (Communication)
   - 통신 연결의 생성, 제거
   - 메시지의 송신, 수신
   - 상태 정보 전달
   - 원격 장치의 부착 및 분리
   - 메시지 전달 - 두 프로세스의 통신에 정보 교환을 위한 메시지
   - 공유 메모리 - 다른 프로세스가 소유한 메모리에 접근을 위해 특정 시스템 콜 호출

![스크린샷 2023-04-16 오전 12.19.02.png](img/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-04-16_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%258C%25E1%2585%25A5%25E1%2586%25AB_12.19.02.png)

### 시스템 콜 실행 과정

1. 응용 프로그램은 시스템 콜 라이브러리 함수 호출
2. 시스템 콜 라이브러리 함수는 커널 모드로 전환하여, 시스템 콜 번호와 함께 커널 내부에서 정의된 해당 시스템 콜 함수 호출
3. 커널은 해당 시스템 콜 함수를 실행하고, 요청에 따라 커널 내부의 다른 함수들 호출
4. 시스템 콜 함수가 완료되면, 커널은 다시 사용자 모드로 전환하여 결과 반환
5. 시스템 콜 라이브러리 함수는 결과를 응용 프로그램에 반환
